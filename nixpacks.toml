[phases.setup]
# Menginstal PHP, Node.js, dan Python 3 berserta Pip dalam satu container
nixPkgs = ['php84', 'nodejs', 'php84Packages.composer', 'python3', 'python311Packages.pip']

[phases.install]
dependsOn = ['setup']
cmds = [
    'composer install --no-dev --optimize-autoloader', 
    'npm install',
    # Menginstal library Python yang dibutuhkan oleh scraper.py
    'pip install requests beautifulsoup4'
]

[phases.build]
dependsOn = ['install']
cmds = [
    'npm run build',
    'php artisan route:cache',
    'php artisan view:cache'
]

[start]
# Urutan eksekusi saat container dijalankan:
# 1. Menjalankan scraper untuk menghasilkan file trends.json
# 2. Membersihkan cache konfigurasi agar Laravel membaca variabel DB PostgreSQL terbaru
# 3. Menjalankan migrasi dan seeder secara paksa
# 4. Menjalankan server (menggunakan apache2-foreground untuk environment produksi)
cmd = 'python3 scraper.py && php artisan config:clear && php artisan migrate --force --seed && apache2-foreground'