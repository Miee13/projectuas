[phases.setup]
nixPkgs = ['php82', 'nodejs', 'php82Packages.composer', 'python3', 'python311Packages.pip']

[phases.install]
dependsOn = ['setup']
cmds = [
    'composer install --no-dev --optimize-autoloader', 
    'npm install',
    'pip install requests beautifulsoup4'
]

[phases.build]
dependsOn = ['install']
cmds = [
    'npm run build', 
    'php artisan route:cache', 
    'php artisan view:cache'
]

[start]
# 1. Jalankan scraper untuk menghasilkan trends.json
# 2. Jalankan migrasi dan seeder ke PostgreSQL
# 3. Jalankan server
cmd = 'python3 scraper.py && php artisan migrate --force --seed && apache2-foreground'